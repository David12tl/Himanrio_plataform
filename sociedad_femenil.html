<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" />
  <link rel="icon" href="../../images/libro.png" />
  <title>Himno Sociedad Femenil</title>
  <link rel="stylesheet" href="../../estilos.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100..900&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="main">
     <div class="sidebar">
            <div class="nav">
                <div class="nav-option">
                    <i class="fa-solid fa-house"></i><a href="index.html">Home</a>
                </div>
                <div class="nav-option">
                    <i class="fa-solid fa-circle-info"></i><a href="#">Acerca de</a>
                </div>
            </div>
            <div class="library">
                <br>
                <div class="options">
                    <div class="lib-option nav-option">
                        <a href="static/introduccion.html">Informacion General</a>
                    </div>
                    <div class="icons">
                        <a href="001-060.html"><i class="fa-solid fa-arrow-right"></i></a>
                    </div>
                </div>
                <button class="menu-toggle">☰ Informacion General</button>
                <div class="lib-menu">
                    <div class="lib-box">
                        <div class="box">
                            <h3>RESEÑA</h3>
                            <p>Conviene considerar el origen y desarrollo de nuestra iglesia...</p>
                            <button class="badge" onclick="location.href='static/reseña.html'">Contenido</button>
                        </div>
                        <div class="box">
                            <h3>Advertencia</h3>
                            <p>Todos los himnos que integran este himnario Sólo a Dios la...</p>
                            <button class="badge" onclick="location.href='static/advertencia.html'">Contenido</button>
                        </div>
                        <div class="box">
                             <h3>Indice</h3>
                            <p>¿Cuál es el fin principal del nombre? El fin principal del...</p>
                            <button class="badge" onclick="location.href='static/indice.html'">Contenido</button>
                        </div>
                        <div class="box">
                            <h3>PRESENTACIÓN</h3>
                            <p>La Iglesia Nacional Presbiteriana de México, como...</p>
                            <button class="badge" onclick="location.href='static/presentacion.html'">Contenido</button>
                        </div>
                        <div class="box">
                            <h3>INTRODUCCIÓN</h3>
                            <p>El canto es tan antiguo como la creación, «cuando ...</p>
                            <button class="badge" onclick="location.href='static/introduccion.html'">Contenido</button>
                        </div>
                        <div class="box">
                            <h3>RECONOCIMIENTO</h3>
                            <p>La honra y la gloria es para Dios, pero el ...</p>
                            <button class="badge" onclick="location.href='static/reconocimiento.html'">Contenido</button>
                        </div>
                        <div class="box">
                            <h3>AYUDAS LITÚRGICAS</h3>
                            <p>Creo en Dios padre Todopoderoso, Creador del...</p>
                            <button class="badge" onclick="location.href='static/ayuda.html'">Contenido</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <div class="main-content">
      <div class="sticky-nav">
        <div class="nav-icons">
          <a href="../../index.html"><img src="../../images/backward_icon.png" class="hide" alt="Back" /></a>
        </div>
      </div>

      <div class="himno" style="color:white; padding:2rem; text-align:center; font-size:1.2rem;">
        <h1 id="himno-titulo">Cargando...</h1>
        <p id="himno-letra">Cargando letra...</p>
      </div>
    </div>
    <!-- Music Player -->
    <div class="music-player">
      <div class="player">
        <audio id="audioPlayer" style="display:none;" preload="auto">
          <source id="audioSource" src="" type="audio/mp3" />
          Tu navegador no soporta el elemento de audio.
        </audio>
        <div class="audio-controls">
          <button id="shuffleBtn" title="Aleatorio"><i class="fa-solid fa-shuffle"></i></button>
          <button id="prevBtn" title="Anterior"><i class="fa-solid fa-backward-step"></i></button>
          <button id="playPauseBtn" class="play" title="Play/Pausa"><i class="fa-solid fa-play"></i></button>
          <button id="nextBtn" title="Siguiente"><i class="fa-solid fa-forward-step"></i></button>
          <button id="repeatBtn" title="Repetir"><i class="fa-solid fa-repeat"></i></button>
        </div>
        <br>
        <div class="progress-container" style="max-width:600px; margin:0 auto;">
          <span id="currentTime" style="color:#fff; font-size:1rem; min-width:50px; display:inline-block;">0:00</span>
          <input type="range" id="progressBar" value="0" min="0" max="100" step="0.1" style="width:70%; margin:0 1rem;">
          <span id="duration" style="color:#fff; font-size:1rem; min-width:50px; display:inline-block;">0:00</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Cargar himno 707 desde letra.json
    fetch('../../app/letra.json')
      .then(res => res.json())
      .then(himnos => {
        if (himnos["707"]) {
          document.getElementById('himno-titulo').textContent = himnos["707"].titulo || "Sin título";
          document.getElementById('himno-letra').innerHTML = (himnos["707"].letra || "").replace(/\\n/g, "<br>");
        } else {
          document.getElementById('himno-titulo').textContent = "Himno no encontrado.";
          document.getElementById('himno-letra').textContent = "";
        }
      })
      .catch(err => {
        console.error("Error al cargar letra.json:", err);
        document.getElementById('himno-titulo').textContent = "Error al cargar el himno.";
        document.getElementById('himno-letra').textContent = "";

         let carpeta = "";
    if (ver >= 1 && ver <= 60) {
      carpeta = "001-060";
    } else if (ver >= 61 && ver <= 110) {
      carpeta = "61-110";
    } else if (ver >= 111 && ver <= 160) {
      carpeta = "111-160";
    } else if (ver >= 161 && ver <= 210) {
      carpeta = "161-210";
    } else if (ver >= 211 && ver <= 300) {
      carpeta = "211-300";
    } else if (ver >= 301 && ver <= 400) {
      carpeta = "301-400";
    } else if (ver >= 401 && ver <= 500) {
      carpeta = "401-500";
    } else if (ver >= 501 && ver <= 600) {
      carpeta = "501-600";
    } else if (ver >= 601 && ver <= 700) {
      carpeta = "601-700";
    } else if (ver >= 701 && ver <= 706) {
      carpeta = "701-706";
    } else if (ver >= 707 && ver <= 707) {
      carpeta = "Sociedad_Femenil"; // Himno de la Sociedad Femenil
    }

    let rutaAudio = "";
    if (ver === 707) {
      rutaAudio = "../himnos/Sociedad_Femenil.mp3";
    } else {
      const numHimno = ver.toString().padStart(3, '0');
      rutaAudio = carpeta ? `../himnos/Sociedad_Femenil.mp3` : "";
    }

    const audioSource = document.getElementById('audioSource');
    const audioPlayer = document.getElementById('audioPlayer');
    if (audioSource && audioPlayer && rutaAudio) {
      audioSource.src = rutaAudio;
      audioPlayer.load();
      // audioPlayer.play(); // El usuario debe dar play manualmente por políticas de navegadores
    }

    // Actualizar duración cuando el audio esté listo
    audioPlayer.addEventListener('loadedmetadata', () => {
      durationEl.textContent = formatTime(audioPlayer.duration);
      progressBar.max = audioPlayer.duration;
    });

    // Actualizar barra y tiempo actual
    audioPlayer.addEventListener('timeupdate', () => {
      currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
      progressBar.value = audioPlayer.currentTime;
    });

    // Permitir al usuario mover la barra
    progressBar.addEventListener('input', () => {
      audioPlayer.currentTime = progressBar.value;
    });

    // --- Controles personalizados ---
    const playPauseBtn = document.getElementById('playPauseBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const repeatBtn = document.getElementById('repeatBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');

    let isPlaying = false;
    let isRepeat = false;
    let isShuffle = false;

    playPauseBtn.addEventListener('click', () => {
      if (audioPlayer.paused) {
        audioPlayer.play();
        playPauseBtn.innerHTML = '<i class="fa-solid fa-pause"></i>';
        playPauseBtn.classList.add('active');
        isPlaying = true;
      } else {
        audioPlayer.pause();
        playPauseBtn.innerHTML = '<i class="fa-solid fa-play"></i>';
        playPauseBtn.classList.remove('active');
        isPlaying = false;
      }
    });

    audioPlayer.addEventListener('ended', () => {
      if (isRepeat) {
        audioPlayer.currentTime = 0;
        audioPlayer.play();
      } else if (isShuffle) {
        // Shuffle: ir a himno aleatorio
        const random = Math.floor(Math.random() * 706) + 1;
        window.location.href = `?ver=${random}`;
      } else {
        // Siguiente himno
        const next = Math.min(ver + 1, 707);
        window.location.href = `?ver=${next}`;
      }
    });

    prevBtn.addEventListener('click', () => {
      const prev = Math.max(ver - 1, 1);
      window.location.href = `?ver=${prev}`;
    });
    nextBtn.addEventListener('click', () => {
      const next = Math.min(ver + 1, 707);
      window.location.href = `?ver=${next}`;
    });

    repeatBtn.addEventListener('click', () => {
      isRepeat = !isRepeat;
      repeatBtn.classList.toggle('active', isRepeat);
    });
    shuffleBtn.addEventListener('click', () => {
      isShuffle = !isShuffle;
      shuffleBtn.classList.toggle('active', isShuffle);
    });

      });

  </script>
  <script src="../../components/script.js"></script>
  <script src="../../components/menu-togle.js"></script>
</body>
</html>

